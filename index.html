<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CSV Cleaner & Copy</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#f9f9f9; }
  textarea { width: 100%; height: 200px; margin-bottom:10px; font-size:14px; }
  button { padding:10px 20px; font-size:16px; cursor:pointer; margin-right:10px; }
  #output { white-space: pre; background:#fff; padding:10px; border:1px solid #ccc; height:300px; overflow:auto; }
</style>
</head>
<body>

<h2>Paste your raw data here:</h2>
<textarea id="rawInput" placeholder="Paste messy data here..."></textarea>
<br>
<button onclick="generateCSV()">Generate CSV</button>
<button onclick="copyCSV()">Copy CSV</button>

<h2>Clean CSV Output:</h2>
<div id="output"></div>

<script>
function generateCSV() {
    let input = document.getElementById('rawInput').value.split('\n');
    let csv = [];
    
    // Add header
    csv.push("SerialNo,EPIC_NO,PartNo,VoterName,RelationName,RelationType,HouseNo,Age,Gender");
    
    input.forEach(line => {
        line = line.trim();
        if(!line) return;

        // Extract EPIC_NO and PartNo if present
        let epicMatch = line.match(/RBG\d+/);
        let partMatch = line.match(/\d+\/\d+\/\d+/);
        let epic_no = epicMatch ? epicMatch[0] : "";
        let part_no = partMatch ? partMatch[0] : "";

        // Remove prefixes like "| मतदाराचे पूर्ण:" etc
        line = line.replace(/\|?\s*(मतदाराचे पूर्ण:|मतदाराचे पूर्ण|राचे पूर्ण:|नांव|Photo|पतीचे नाव|वडिलांचे नाव|Available|Photo Available):?/gi, '').trim();

        // Gender extraction
        let gender = "";
        if(line.match(/Male|पुरुष|pu|पु/i)) gender="पु";
        else if(line.match(/Female|स्त्री|str/i)) gender="स्त्री";

        // Remove gender from line
        line = line.replace(/Male|Female|पुरुष|स्त्री|pu|पु|str/gi, '').trim();

        // SerialNo (if starts with number)
        let serial = "";
        let serialMatch = line.match(/^\d+/);
        if(serialMatch) { serial = serialMatch[0]; line = line.replace(/^\d+\s*/, ''); }

        // Push cleaned row
        csv.push([serial || "NA", epic_no, part_no, `"${line}"`, "", "", "", "", gender].join(','));
    });

    document.getElementById('output').textContent = csv.join('\n');
}

function copyCSV() {
    let output = document.getElementById('output').textContent;
    navigator.clipboard.writeText(output).then(() => {
        alert("CSV copied to clipboard!");
    });
}
</script>

</body>
</html>
