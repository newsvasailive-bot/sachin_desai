<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text to JSON & CSV for Firebase</title>
<style>
body { font-family: Arial; background:#f2f2f2; padding:20px; }
textarea { width:100%; height:250px; padding:10px; font-size:15px; }
button { padding:10px 20px; margin:10px 5px 10px 0; cursor:pointer; font-size:15px; }
table { width:100%; border-collapse:collapse; margin-top:20px; background:#fff; }
th, td { border:1px solid #ccc; padding:8px; font-size:14px; text-align:left; }
th { background:#222; color:#fff; }
</style>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<h2>Voter Text → JSON & CSV → Firebase</h2>

<textarea id="input" placeholder="Yahan voter text paste karein..."></textarea><br>
<button onclick="extract()">Extract</button>
<button onclick="downloadCSV()">Download CSV</button>
<button onclick="downloadJSON()">Download JSON</button>
<button onclick="sendFirebase()">Send to Firebase</button>

<table id="output">
<thead>
<tr>
<th>SerialNo</th>
<th>EPIC_NO</th>
<th>PartNo</th>
<th>VoterName</th>
<th>RelationName</th>
<th>RelationType</th>
<th>HouseNo</th>
<th>Age</th>
<th>Gender</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

firebase.initializeApp(firebaseConfig);

// --- Extraction ---
function extract() {
    let text = document.getElementById("input").value;
    let lines = text.split("\n").map(x => x.trim()).filter(x => x);
    let tbody = document.querySelector("#output tbody");
    tbody.innerHTML = "";

    let voter = {};
    let results = [];

    function save() {
        if (!voter.SerialNo || !voter.EPIC_NO || !voter.VoterName) return;
        voter.RelationName = voter.RelationName || "NA";
        voter.RelationType = voter.RelationType || "NA";
        voter.HouseNo = voter.HouseNo || "NA";
        voter.Age = voter.Age || "NA";
        voter.Gender = voter.Gender || "NA";
        voter.PartNo = voter.PartNo || "NA";
        results.push({ ...voter });
        voter = {};
    }

    lines.forEach(line => {
        if (/^\d{1,4}$/.test(line)) { save(); voter.SerialNo = line; return; }
        if (/^[A-Z]{3}\d{5,}/.test(line.replace(/\s/g, ""))) {
            let cleaned = line.replace(/\s/g,"");
            voter.EPIC_NO = cleaned.match(/^[A-Z]{3}\d{5,}/)[0];
            let p = cleaned.match(/\d+\/\d+\/\d+/);
            if (p) voter.PartNo = p[0];
            return;
        }
        if (line.includes("मतदाराचे पूर्ण") || line.includes("मतदाराचे नाव") || line.includes("नांव")) {
            voter.VoterName = line.split(":").pop().trim();
            return;
        }
        if (line.includes("पतीचे") || line.includes("पति")) {
            voter.RelationType = "Husband";
            voter.RelationName = line.split(":").pop().trim();
            return;
        }
        if (line.includes("वडिलांचे") || line.includes("वडील") || line.includes("Father")) {
            voter.RelationType = "Father";
            voter.RelationName = line.split(":").pop().trim();
            return;
        }
        if (line.includes("घर क्रमांक")) { voter.HouseNo = line.split(":").pop().trim() || "NA"; return; }
        if (line.includes("वय")) { voter.Age = line.split(":").pop().trim(); return; }
        if (line.includes("लिंग") || line.includes("Gender")) {
            voter.Gender = (line.includes("स्त्री") || line.includes("Female")) ? "Female" : "Male";
            save(); // Save on gender
            return;
        }
    });
    save();

    // Show table
    results.forEach(r => {
        tbody.innerHTML += `<tr>
            <td>${r.SerialNo}</td>
            <td>${r.EPIC_NO}</td>
            <td>${r.PartNo}</td>
            <td>${r.VoterName}</td>
            <td>${r.RelationName}</td>
            <td>${r.RelationType}</td>
            <td>${r.HouseNo}</td>
            <td>${r.Age}</td>
            <td>${r.Gender}</td>
        </tr>`;
    });

    window.extracted = results;
}

// --- Download CSV ---
function downloadCSV() {
    if (!window.extracted) return alert("Extract pehle karein!");
    let csv = "SerialNo,EPIC_NO,PartNo,VoterName,RelationName,RelationType,HouseNo,Age,Gender\n";
    window.extracted.forEach(r => {
        csv += `${r.SerialNo},${r.EPIC_NO},${r.PartNo},"${r.VoterName}","${r.RelationName}","${r.RelationType}","${r.HouseNo}","${r.Age}","${r.Gender}"\n`;
    });
    const blob = new Blob([csv], { type:"text/csv;charset=utf-8;" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "voter_list.csv";
    a.click();
}

// --- Download JSON ---
function downloadJSON() {
    if (!window.extracted) return alert("Extract pehle karein!");
    const blob = new Blob([JSON.stringify(window.extracted,null,2)], { type:"application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "voter_list.json";
    a.click();
}

// --- Send to Firebase ---
function sendFirebase() {
    if (!window.extracted) return alert("Extract pehle karein!");
    const dbRef = firebase.database().ref('voters');
    window.extracted.forEach(voter => {
        dbRef.push(voter);
    });
    alert("Data Firebase me bhej diya gaya!");
}
</script>

</body>
</html>
