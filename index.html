<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter List Auto Extractor</title>
<style>
body { font-family: Arial; padding: 20px; background: #f7f7f7; }
textarea { width: 100%; height: 250px; padding: 10px; font-size: 15px; }
button { padding: 10px 20px; margin: 10px 0; font-size: 16px; cursor: pointer; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #999; padding: 6px; font-size: 14px; }
th { background: #333; color: #fff; }
</style>
</head>
<body>

<h2>ðŸ—³ Voter List Auto Extractor (Age Fix Included)</h2>

<textarea id="raw" placeholder="Yahan voter list ka raw text paste kare (100 ek saath)"></textarea>
<br>
<button onclick="extract()">Extract Voters</button>
<button onclick="downloadCSV()">Download CSV</button>

<table id="output"></table>

<script>
function convertMarathiNum(str) {
    const map = { 'à¥¦':0,'à¥§':1,'à¥¨':2,'à¥©':3,'à¥ª':4,'à¥«':5,'à¥¬':6,'à¥­':7,'à¥®':8,'à¥¯':9 };
    return str.replace(/[à¥¦-à¥¯]/g, d => map[d]);
}

function extract() {
    let raw = document.getElementById("raw").value;

    let lines = raw.split("\n");
    let data = [];

    let serial = "";
    let epic = "";
    let part = "";
    let name = "";
    let relName = "";
    let relType = "";
    let house = "";
    let age = "";
    let gender = "";

    const table = document.getElementById("output");
    table.innerHTML = `
        <tr>
            <th>SerialNo</th><th>EPIC_NO</th><th>PartNo</th><th>VoterName</th>
            <th>RelationName</th><th>RelationType</th><th>HouseNo</th>
            <th>Age</th><th>Gender</th>
        </tr>
    `;

    lines.forEach(line => {
        line = line.trim();

        // SERIAL + EPIC + PART
        if (/^\d+$/.test(line)) serial = line;

        if (/^[A-Z]{3}\d+/.test(line)) {
            let p = line.split(" ");
            epic = p[0];
            part = p[1] || "";
        }

        // NAME
        if (line.includes("à¤®à¤¤à¤¦à¤¾à¤°à¤¾à¤šà¥‡ à¤ªà¥‚à¤°à¥à¤£") || line.includes("à¤¨à¤¾à¤‚à¤µ")) {
            name = line.replace(/.*:\s*/, "").trim();
        }

        // RELATION
        if (line.includes("à¤µà¤¡à¤¿à¤²à¤¾à¤‚à¤šà¥‡ à¤¨à¤¾à¤µ")) {
            relType = "Father";
            relName = line.replace(/.*:\s*/, "");
        }
        if (line.includes("à¤ªà¤¤à¥€à¤šà¥‡ à¤¨à¤¾à¤µ")) {
            relType = "Husband";
            relName = line.replace(/.*:\s*/, "");
        }

        // HOUSE
        if (line.includes("à¤˜à¤° à¤•à¥à¤°à¤®à¤¾à¤‚à¤•")) {
            house = line.replace(/.*:\s*/, "").trim();
        }

        // AGE
        if (line.includes("à¤µà¤¯")) {
            let a = line.replace(/.*:\s*/, "").trim();
            age = convertMarathiNum(a);
        }

        // GENDER
        if (line.includes("à¤²à¤¿à¤‚à¤—")) {
            if (line.includes("à¤ªà¥")) gender = "Male";
            else if (line.includes("à¤¸à¥à¤¤à¥à¤°à¥€")) gender = "Female";

            // Record Completed â†’ Push Row
            data.push([serial, epic, part, name, relName, relType, house, age, gender]);

            // Clear for next voter
            serial = epic = part = name = relName = relType = house = age = gender = "";
        }
    });

    // Fill Table
    data.forEach(r => {
        let row = "<tr>";
        r.forEach(c => row += `<td>${c}</td>`);
        row += "</tr>";
        table.innerHTML += row;
    });
}

// DOWNLOAD CSV
function downloadCSV() {
    let csv = "SerialNo,EPIC_NO,PartNo,VoterName,RelationName,RelationType,HouseNo,Age,Gender\n";
    document.querySelectorAll("#output tr").forEach((tr, i) => {
        if (i === 0) return;
        let cols = tr.querySelectorAll("td");
        let row = [];
        cols.forEach(td => row.push(td.innerText));
        csv += row.join(",") + "\n";
    });

    let blob = new Blob([csv], { type: "text/csv" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "voter_list.csv";
    a.click();
}
</script>

</body>
</html>
