<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter List Auto Extractor</title>
<style>
body { font-family: Arial; background:#f9f9f9; padding:20px; }
textarea { width:100%; height:250px; padding:10px; font-size:14px; }
button { padding:10px 20px; margin-top:10px; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:20px; background:#fff; }
th, td { border:1px solid #ccc; padding:8px; font-size:14px; text-align:left; }
th { background:#333; color:#fff; }
</style>
</head>
<body>

<h2>Voter List Auto Extractor</h2>

<textarea id="input" placeholder="Yahan poora voter list paste karein..."></textarea><br>
<button onclick="extract()">Extract & Show</button>
<button onclick="downloadCSV()">Download CSV</button>

<table id="output">
    <thead>
        <tr>
            <th>SerialNo</th>
            <th>EPIC_NO</th>
            <th>PartNo</th>
            <th>VoterName</th>
            <th>RelationName</th>
            <th>RelationType</th>
            <th>HouseNo</th>
            <th>Age</th>
            <th>Gender</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
function extract() {
    let text = document.getElementById("input").value;
    let lines = text.split("\n");
    let tbody = document.querySelector("#output tbody");
    tbody.innerHTML = "";
    let results = [];

    let serial = 1;
    let voterID = "", partNo = "", name = "", relName = "", relType = "", house = "", age = "", gender = "";

    lines.forEach(line => {
        line = line.trim();

        // EPIC + Part
        if (/^[A-Z]{3}\d{7}/.test(line)) {
            let parts = line.split(" ");
            voterID = parts[0];
            partNo = parts[1] || "";
        }

        // Name
        if (line.includes("मतदाराचे पूर्ण") || line.includes("नांव")) {
            name = line.replace(/.*[: ]/, "").trim();
        }

        // Father / Husband
        if (line.includes("वडिलांचे नाव")) {
            relName = line.replace(/.*:/, "").trim();
            relType = "Father";
        }
        if (line.includes("पतीचे नाव")) {
            relName = line.replace(/.*:/, "").trim();
            relType = "Husband";
        }

        // HouseNo
        if (line.includes("घर क्रमांक")) {
            house = line.replace(/.*:/, "").trim();
        }

        // Age
        if (line.includes("वय")) {
            age = line.replace(/.*:/, "").trim();
        }

        // Gender
        if (line.includes("लिंग")) {
            gender = line.includes("पु") ? "Male" : "Female";

            // Push record
            results.push({
                serial: serial++,
                voterID,
                partNo,
                name,
                relName,
                relType,
                house,
                age,
                gender
            });

            // Reset temp vars
            voterID = partNo = name = relName = relType = house = age = gender = "";
        }
    });

    // Show in table
    results.forEach(r => {
        let tr = `<tr>
            <td>${r.serial}</td>
            <td>${r.voterID}</td>
            <td>${r.partNo}</td>
            <td>${r.name}</td>
            <td>${r.relName}</td>
            <td>${r.relType}</td>
            <td>${r.house}</td>
            <td>${r.age}</td>
            <td>${r.gender}</td>
        </tr>`;
        tbody.innerHTML += tr;
    });

    window.extracted = results;
}

function downloadCSV() {
    if (!window.extracted) return;

    let csv = "SerialNo,EPIC_NO,PartNo,VoterName,RelationName,RelationType,HouseNo,Age,Gender\n";
    window.extracted.forEach(r => {
        csv += `${r.serial},${r.voterID},${r.partNo},${r.name},${r.relName},${r.relType},${r.house},${r.age},${r.gender}\n`;
    });

    let blob = new Blob([csv], { type: "text/csv" });
    let url = URL.createObjectURL(blob);
    let a = document.createElement("a");
    a.href = url;
    a.download = "voter_list.csv";
    a.click();
}
</script>

</body>
</html>
