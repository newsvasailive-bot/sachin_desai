<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter Parser</title>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial; padding:20px; background:#f9f9f9; }
textarea { width:100%; height:200px; margin-bottom:10px; }
pre { background:#eee; padding:10px; white-space:pre-wrap; }
button { padding:10px 15px; margin:5px; }
</style>
</head>
<body>

<h2>Voter List Parser</h2>

<textarea id="voterText" placeholder="Paste raw text..."></textarea>
<br>
<button onclick="parseVoters()">Parse</button>

<pre id="jsonOutput"></pre>

<script>
// ----------------- CLEANER -----------------
function clean(str) {
    if (!str) return "";
    return str
        .replace(/Available/gi, "")
        .replace(/Photo/gi, "")
        .replace(/नांव/gi, "")
        .replace(/\|/g, "")
        .trim();
}

// ----------------- FIREBASE -----------------
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ----------------- PARSER -----------------
let voters = [];

function parseVoters() {

    const text = document.getElementById("voterText").value;
    const lines = text.split(/\r?\n/);

    voters = [];
    let current = {};
    let serial = 1;

    lines.forEach(line => {

        line = clean(line);
        if (!line) return;

        // -------- EPIC + PART ----------
        const epic = line.match(/RBG\d+/);
        const part = line.match(/\d{1,3}\/\d{1,3}\/\d{1,4}/);

        if (epic && part) {

            // previous save
            if (Object.keys(current).length > 0) {
                voters.push(current);
            }

            // new voter
            current = {
                SerialNo: serial++,
                EPIC_NO: epic[0],
                PartNo: part[0],
                VoterName: "",
                RelationName: "",
                RelationType: "",
                HouseNo: "",
                Age: "",
                Gender: ""
            };
        }

        // -------- NAME ----------
        if (line.includes("मतदाराचे पूर्ण")) {
            let name = clean(line.split(":")[1]);
            if (name && name.length > 1) {
                current.VoterName = name;
            }
        }

        // -------- Relation Husband ----------
        if (line.includes("पतीचे नाव")) {
            let name = clean(line.split(":")[1]);
            if (name) {
                current.RelationName = name;
                current.RelationType = "Husband";
            }
        }

        // -------- Relation Father ----------
        if (line.includes("वडिलांचे नाव")) {
            let name = clean(line.split(":")[1]);
            if (name) {
                current.RelationName = name;
                current.RelationType = "Father";
            }
        }

        // -------- House ----------
        if (line.includes("घर क्रमांक")) {
            let h = clean(line.split(":")[1]);
            if (h) current.HouseNo = h;
        }

        // -------- Age ----------
        if (line.includes("वय")) {
            let age = line.match(/\d+/);
            if (age) current.Age = age[0];
        }

        // -------- Gender ----------
        if (line.includes("लिंग")) {
            if (line.includes("पु")) current.Gender = "Male";
            else if (line.includes("स्त्री")) current.Gender = "Female";
        }

    });

    // last save
    if (Object.keys(current).length > 0) {
        voters.push(current);
    }

    // Show JSON
    document.getElementById("jsonOutput").textContent =
        JSON.stringify(voters, null, 2);
}
</script>

</body>
</html>
