<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter List CSV Generator ЁЯЪА</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    padding: 20px;
  }
  h2 {
    text-align: center;
    color: #333;
  }
  textarea {
    width: 100%;
    height: 300px;
    padding: 10px;
    margin-bottom: 15px;
    font-size: 14px;
    box-sizing: border-box;
    resize: vertical;
  }
  .button-container {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  button {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    color: white;
    transition: 0.3s;
  }
  #generateButton { background: #007bff; }
  #generateButton:hover { background: #0056b3; }
  #copyButton { background: #28a745; }
  #copyButton:hover { background: #218838; }
  #outputCSV {
    width: 100%;
    height: 300px;
    padding: 10px;
    font-family: Consolas, monospace;
    font-size: 13px;
    border: 1px solid #ddd;
    box-sizing: border-box;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<h2>Voter List CSV Generator ЁЯЪА</h2>
<p>рдЕрдкрдирд╛ raw voter text рдпрд╣рд╛рдБ paste рдХрд░реЗрдВ:</p>
<textarea id="inputText" placeholder="Raw voter text paste рдХрд░реЗрдВ..."></textarea>

<div class="button-container">
  <button id="generateButton">CSV Generate рдХрд░реЗрдВ</button>
  <button id="copyButton" disabled>ЁЯУЛ Copy CSV</button>
</div>

<h3>Generated CSV:</h3>
<textarea id="outputCSV" readonly placeholder="CSV output рдпрд╣рд╛рдБ рджрд┐рдЦреЗрдЧрд╛..."></textarea>

<script>
function parseVoterText(text) {
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l !== "");
  const csvRows = [];
  const header = ["SerialNo","EPIC_NO","PartNo","VoterName","RelationName","RelationType","HouseNo","Age","Gender"];
  csvRows.push(header.join(","));

  let serialNo = 1;

  for(let i=0; i<lines.length; i++){
    const line = lines[i];

    // Basic EPIC_NO + PartNo pattern detection
    const epicMatch = line.match(/([A-Z]{2,3}\d+)\s+(\d+\/\d+\/\d+)/);
    if(epicMatch){
      const EPIC_NO = epicMatch[1];
      const PartNo = epicMatch[2];

      // Look back and ahead to find VoterName, RelationName, RelationType, HouseNo, Age, Gender
      let voterName = "", relationName = "", relationType = "", houseNo = "", age = "", gender = "";

      // Scan previous 2 lines for voter name
      for(let j = i-2; j<=i+2; j++){
        if(lines[j]){
          const l = lines[j];
          if(/рдорддрджрд╛рд░рд╛рдЪреЗ рдкреВрд░реНрдг:|рдирд╛рдВрд╡|Photo|Voter/.test(l) && !voterName){
            voterName = l.replace(/рдорддрджрд╛рд░рд╛рдЪреЗ рдкреВрд░реНрдг:|рдирд╛рдВрд╡|Photo|Available/gi,"").trim();
          }
          if(/рд╡рдбрд┐рд▓рд╛рдВрдЪреЗ рдирд╛рд╡|рдкрддреАрдЪреЗ рдирд╛рд╡|рдЖрдИрдЪреЗ рдирд╛рд╡/.test(l) && !relationName){
            relationName = l.replace(/рд╡рдбрд┐рд▓рд╛рдВрдЪреЗ рдирд╛рд╡|рдкрддреАрдЪреЗ рдирд╛рд╡|рдЖрдИрдЪреЗ рдирд╛рд╡|Available/gi,"").trim();
            if(/рд╡рдбрд┐рд▓/.test(l)) relationType="Father";
            else if(/рдкрддреА/.test(l)) relationType="Husband";
            else if(/рдЖрдИ/.test(l)) relationType="Mother";
          }
          if(/рдШрд░ рдХреНрд░рдорд╛рдВрдХ/.test(l) && !houseNo){
            houseNo = l.replace(/рдШрд░ рдХреНрд░рдорд╛рдВрдХ[:]?/,"").trim();
          }
          if(/рд╡рдп\s*[:]?/.test(l) && !age){
            const ageMatch = l.match(/рд╡рдп\s*[:]? (\d+)/);
            if(ageMatch) age = ageMatch[1];
          }
          if(/рд▓рд┐рдВрдЧ/.test(l) && !gender){
            if(/рд╕реНрддреНрд░реА/.test(l)) gender="Female";
            else if(/рдкреБ/.test(l)) gender="Male";
          }
        }
      }

      csvRows.push([serialNo,EPIC_NO,PartNo,voterName||"NA",relationName||"NA",relationType||"NA",houseNo||"NA",age||"NA",gender||"NA"].join(","));
      serialNo++;
    }
  }

  return csvRows.join("\n");
}

document.getElementById("generateButton").addEventListener("click", ()=>{
  const inputText = document.getElementById("inputText").value;
  if(!inputText.trim()){
    alert("рдХреГрдкрдпрд╛ raw voter text paste рдХрд░реЗрдВ!");
    return;
  }
  const csvOutput = parseVoterText(inputText);
  document.getElementById("outputCSV").value = csvOutput;
  document.getElementById("copyButton").disabled = false;
});

document.getElementById("copyButton").addEventListener("click", ()=>{
  const output = document.getElementById("outputCSV");
  output.select();
  output.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("CSV copied to clipboard! ЁЯУЛ");
});
</script>

</body>
</html>
