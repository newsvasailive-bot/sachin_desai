<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF to CSV Converter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
<style>
body { font-family: Arial; margin:20px; }
#result { white-space: pre-wrap; background:#f1f1f1; padding:15px; margin-top:10px; }
button { padding:10px 15px; margin:10px 0; }
</style>
</head>
<body>

<h2>PDF → TEXT → CSV Converter</h2>

<input type="file" id="pdfFile" accept="application/pdf">
<button onclick="convertPDF()">Convert to CSV</button>

<h3>Extracted Text:</h3>
<div id="result"></div>

<script>
function convertPDF() {
    let file = document.getElementById("pdfFile").files[0];
    if (!file) { alert("Please select a PDF file"); return; }

    let reader = new FileReader();
    reader.onload = function () {
        let typedarray = new Uint8Array(this.result);

        pdfjsLib.getDocument(typedarray).promise.then(async function (pdf) {
            let textContent = "";

            for (let i = 1; i <= pdf.numPages; i++) {
                let page = await pdf.getPage(i);
                let txt = await page.getTextContent();
                txt.items.forEach(t => textContent += t.str + " ");
                textContent += "\n";
            }

            document.getElementById("result").textContent = textContent;

            // CLEAN → CSV
            let lines = textContent
                .replace(/\s+/g, " ") 
                .trim()
                .split("\n")
                .map(l => `"${l.trim().replace(/"/g, "")}"`);

            let csvData = "Line\n" + lines.join("\n");

            // DOWNLOAD CSV
            let blob = new Blob([csvData], { type: "text/csv" });
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "output.csv";
            link.click();
        });
    };

    reader.readAsArrayBuffer(file);
}
</script>

</body>
</html>
