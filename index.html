<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter CSV Generator ðŸ”¥</title>
<style>
body { font-family: Arial,sans-serif; background:#f7f7f7; padding:20px; }
h2 { text-align:center; color:#333; }
textarea { width:100%; height:300px; padding:10px; margin-bottom:15px; font-size:14px; box-sizing:border-box; resize: vertical; }
.button-container { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
button { flex:1; padding:12px; font-size:16px; cursor:pointer; border:none; border-radius:5px; color:white; transition:.3s; }
#generateButton { background:#007bff; } #generateButton:hover { background:#0056b3; }
#copyButton { background:#28a745; } #copyButton:hover { background:#218838; }
#outputCSV { width:100%; height:300px; padding:10px; font-family:Consolas,monospace; font-size:13px; border:1px solid #ddd; box-sizing:border-box; white-space:pre-wrap; }
</style>
</head>
<body>

<h2>Voter List CSV Generator ðŸš€</h2>
<p>Raw voter text paste à¤•à¤°à¥‡à¤‚:</p>
<textarea id="inputText" placeholder="Raw voter text paste à¤•à¤°à¥‡à¤‚..."></textarea>

<div class="button-container">
<button id="generateButton">CSV Generate à¤•à¤°à¥‡à¤‚</button>
<button id="copyButton" disabled>ðŸ“‹ Copy CSV</button>
</div>

<h3>Generated CSV:</h3>
<textarea id="outputCSV" readonly placeholder="CSV output à¤¯à¤¹à¤¾à¤ à¤¦à¤¿à¤–à¥‡à¤—à¤¾..."></textarea>

<script>
function smartParseVoterText(text){
    const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l!=="");
    const csvRows = [];
    const header = ["SerialNo","EPIC_NO","PartNo","VoterName","RelationName","RelationType","HouseNo","Age","Gender"];
    csvRows.push(header.join(","));

    let serialNo=1;
    let current = {};

    for(let i=0;i<lines.length;i++){
        let line = lines[i];

        // EPIC_NO + PartNo detection
        let epicMatch = line.match(/([A-Z]{2,3}\d+)\s+(\d+\/\d+\/\d+)/);
        if(epicMatch){
            // Save previous voter
            if(current.EPIC_NO) {
                csvRows.push([
                    serialNo,
                    current.EPIC_NO || "NA",
                    current.PartNo || "NA",
                    current.VoterName || "NA",
                    current.RelationName || "NA",
                    current.RelationType || "NA",
                    current.HouseNo || "NA",
                    current.Age || "NA",
                    current.Gender || "NA"
                ].join(","));
                serialNo++;
            }
            // Start new voter
            current = {
                EPIC_NO: epicMatch[1],
                PartNo: epicMatch[2],
                VoterName: "",
                RelationName: "",
                RelationType: "",
                HouseNo: "",
                Age: "",
                Gender: ""
            };
            continue;
        }

        // Voter Name
        if(/à¤®à¤¤à¤¦à¤¾à¤°à¤¾à¤šà¥‡ à¤ªà¥‚à¤°à¥à¤£:|à¤¨à¤¾à¤‚à¤µ/.test(line)){
            current.VoterName = line.replace(/à¤®à¤¤à¤¦à¤¾à¤°à¤¾à¤šà¥‡ à¤ªà¥‚à¤°à¥à¤£:|à¤¨à¤¾à¤‚à¤µ|Photo|Available/gi,"").trim() || current.VoterName;
        }

        // Relation Name & Type
        if(/à¤µà¤¡à¤¿à¤²à¤¾à¤‚à¤šà¥‡ à¤¨à¤¾à¤µ/.test(line)){
            current.RelationName = line.replace(/à¤µà¤¡à¤¿à¤²à¤¾à¤‚à¤šà¥‡ à¤¨à¤¾à¤µ|Available/gi,"").trim();
            current.RelationType = "Father";
        } else if(/à¤ªà¤¤à¥€à¤šà¥‡ à¤¨à¤¾à¤µ/.test(line)){
            current.RelationName = line.replace(/à¤ªà¤¤à¥€à¤šà¥‡ à¤¨à¤¾à¤µ|Available/gi,"").trim();
            current.RelationType = "Husband";
        } else if(/à¤†à¤ˆà¤šà¥‡ à¤¨à¤¾à¤µ/.test(line)){
            current.RelationName = line.replace(/à¤†à¤ˆà¤šà¥‡ à¤¨à¤¾à¤µ|Available/gi,"").trim();
            current.RelationType = "Mother";
        }

        // HouseNo
        if(/à¤˜à¤° à¤•à¥à¤°à¤®à¤¾à¤‚à¤•/.test(line)){
            current.HouseNo = line.replace(/à¤˜à¤° à¤•à¥à¤°à¤®à¤¾à¤‚à¤•[:]?/,"").trim();
        }

        // Age
        if(/à¤µà¤¯/.test(line)){
            let m = line.match(/à¤µà¤¯[:]? (\d+)/);
            if(m) current.Age = m[1];
        }

        // Gender
        if(/à¤²à¤¿à¤‚à¤—/.test(line)){
            if(/à¤¸à¥à¤¤à¥à¤°à¥€/.test(line)) current.Gender="Female";
            else if(/à¤ªà¥/.test(line)) current.Gender="Male";
        }
    }

    // Last voter
    if(current.EPIC_NO){
        csvRows.push([
            serialNo,
            current.EPIC_NO || "NA",
            current.PartNo || "NA",
            current.VoterName || "NA",
            current.RelationName || "NA",
            current.RelationType || "NA",
            current.HouseNo || "NA",
            current.Age || "NA",
            current.Gender || "NA"
        ].join(","));
    }

    return csvRows.join("\n");
}

document.getElementById("generateButton").addEventListener("click",()=>{
    const inputText = document.getElementById("inputText").value;
    if(!inputText.trim()){
        alert("à¤•à¥ƒà¤ªà¤¯à¤¾ raw voter text paste à¤•à¤°à¥‡à¤‚!");
        return;
    }
    const csvOutput = smartParseVoterText(inputText);
    document.getElementById("outputCSV").value = csvOutput;
    document.getElementById("copyButton").disabled=false;
});

document.getElementById("copyButton").addEventListener("click",()=>{
    const output = document.getElementById("outputCSV");
    output.select();
    output.setSelectionRange(0,99999);
    document.execCommand("copy");
    alert("CSV clipboard à¤®à¥‡à¤‚ copy à¤¹à¥‹ à¤—à¤¯à¤¾! ðŸ“‹");
});
</script>
</body>
</html>
