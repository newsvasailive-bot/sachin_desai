<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter CSV Cleaner & Generator</title>
<style>
body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
h2 { text-align:center; color:#333; }
textarea { width:100%; height:300px; padding:10px; margin-bottom:15px; font-size:14px; box-sizing:border-box; resize: vertical; }
.button-container { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
button { flex:1; padding:12px; font-size:16px; cursor:pointer; border:none; border-radius:5px; color:white; transition:.3s; }
#generateButton { background:#007bff; } #generateButton:hover { background:#0056b3; }
#copyButton { background:#28a745; } #copyButton:hover { background:#218838; }
#downloadButton { background:#ffc107; color:#000; } #downloadButton:hover { background:#e0a800; }
#outputCSV { width:100%; height:300px; padding:10px; font-family:Consolas,monospace; font-size:13px; border:1px solid #ddd; box-sizing:border-box; white-space:pre-wrap; }
</style>
</head>
<body>

<h2>Voter CSV Cleaner & Generator üöÄ</h2>
<p>Raw voter text paste ‡§ï‡§∞‡•á‡§Ç:</p>
<textarea id="inputText" placeholder="Raw voter text paste ‡§ï‡§∞‡•á‡§Ç..."></textarea>

<div class="button-container">
<button id="generateButton">CSV Generate ‡§ï‡§∞‡•á‡§Ç</button>
<button id="copyButton" disabled>üìã Copy CSV</button>
<button id="downloadButton" disabled>‚¨áÔ∏è Download CSV</button>
</div>

<h3>Generated CSV:</h3>
<textarea id="outputCSV" readonly placeholder="CSV output ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ..."></textarea>

<script>
function parseVoterTextToCSV(text){
    const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l!=="");
    const csvRows = [];
    const header = ["SerialNo","EPIC_NO","PartNo","VoterName","RelationName","RelationType","HouseNo","Age","Gender"];
    csvRows.push(header.join(","));

    let current={};

    const saveCurrentVoter = () => {
        if(current.EPIC_NO){
            csvRows.push([
                current.SerialNo||"NA",
                current.EPIC_NO||"NA",
                current.PartNo||"NA",
                current.VoterName||"NA",
                current.RelationName||"NA",
                current.RelationType||"NA",
                current.HouseNo||"NA",
                current.Age||"NA",
                current.Gender||"NA"
            ].map(v=>v.includes(",")?`"${v}"`:v).join(","));
        }
    };

    for(let line of lines){
        // SerialNo detection
        const serialMatch = line.match(/^(\d+)[,|\s]/);
        if(serialMatch){
            current.SerialNo = serialMatch[1];
        }

        // EPIC_NO + PartNo
        const epicMatch = line.match(/([A-Z]{2,3}\d+)\s+(\d+\/\d+\/\d+)/);
        if(epicMatch){
            saveCurrentVoter();
            current = {SerialNo:current.SerialNo||"NA", EPIC_NO:epicMatch[1], PartNo:epicMatch[2], VoterName:"", RelationName:"", RelationType:"", HouseNo:"", Age:"", Gender:""};
            continue;
        }

        // Voter Name
        if(/‡§Æ‡§§‡§¶‡§æ‡§∞‡§æ‡§ö‡•á ‡§™‡•Ç‡§∞‡•ç‡§£:|‡§®‡§æ‡§Ç‡§µ/.test(line)){
            current.VoterName = line.replace(/‡§Æ‡§§‡§¶‡§æ‡§∞‡§æ‡§ö‡•á ‡§™‡•Ç‡§∞‡•ç‡§£:|‡§®‡§æ‡§Ç‡§µ|Photo|Available/gi,"").trim() || current.VoterName;
        }

        // Relation
        if(/‡§µ‡§°‡§ø‡§≤‡§æ‡§Ç‡§ö‡•á ‡§®‡§æ‡§µ/.test(line)){
            current.RelationName = line.replace(/‡§µ‡§°‡§ø‡§≤‡§æ‡§Ç‡§ö‡•á ‡§®‡§æ‡§µ|Available/gi,"").trim();
            current.RelationType = "Father";
        } else if(/‡§™‡§§‡•Ä‡§ö‡•á ‡§®‡§æ‡§µ/.test(line)){
            current.RelationName = line.replace(/‡§™‡§§‡•Ä‡§ö‡•á ‡§®‡§æ‡§µ|Available/gi,"").trim();
            current.RelationType = "Husband";
        } else if(/‡§Ü‡§à‡§ö‡•á ‡§®‡§æ‡§µ/.test(line)){
            current.RelationName = line.replace(/‡§Ü‡§à‡§ö‡•á ‡§®‡§æ‡§µ|Available/gi,"").trim();
            current.RelationType = "Mother";
        }

        // HouseNo
        if(/‡§ò‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï/.test(line)){
            current.HouseNo = line.replace(/‡§ò‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï[:]?/,"").trim() || current.HouseNo;
        }

        // Age
        if(/‡§µ‡§Ø/.test(line)){
            const m = line.match(/‡§µ‡§Ø[:]? (\d+)/);
            if(m) current.Age = m[1];
        }

        // Gender
        if(/‡§≤‡§ø‡§Ç‡§ó/.test(line)){
            if(/‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä/.test(line)) current.Gender="Female";
            else if(/‡§™‡•Å/.test(line)) current.Gender="Male";
        }
    }

    // Last voter
    saveCurrentVoter();

    return csvRows.join("\n");
}

document.getElementById("generateButton").addEventListener("click",()=>{
    const inputText = document.getElementById("inputText").value;
    if(!inputText.trim()){ alert("Raw voter text paste ‡§ï‡§∞‡•á‡§Ç!"); return; }
    const csvOutput = parseVoterTextToCSV(inputText);
    document.getElementById("outputCSV").value = csvOutput;
    document.getElementById("copyButton").disabled=false;
    document.getElementById("downloadButton").disabled=false;
});

document.getElementById("copyButton").addEventListener("click",()=>{
    const output = document.getElementById("outputCSV");
    output.select();
    document.execCommand("copy");
    alert("CSV clipboard ‡§Æ‡•á‡§Ç copy ‡§π‡•ã ‡§ó‡§Ø‡§æ! üìã");
});

document.getElementById("downloadButton").addEventListener("click",()=>{
    const csvData = document.getElementById("outputCSV").value;
    const blob = new Blob([csvData], {type:"text/csv;charset=utf-8;"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "voter_list.csv";
    link.click();
});
</script>
</body>
</html>
