<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter List → CSV (Perfect Format)</title>

<style>
body { font-family: Arial; padding: 20px; background: #f5f5f5; }
textarea { width: 100%; height: 230px; padding: 10px; margin-bottom: 10px; }
.btn { background: #007bff; color: #fff; padding: 12px 20px; border: none; cursor: pointer; border-radius: 6px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
th, td { border: 1px solid #ccc; padding: 8px; }
th { background: #e9e9e9; }
</style>
</head>

<body>

<h2>Voter List → CSV (Perfect Format)</h2>

<textarea id="inputText" placeholder="यहाँ Voter List का raw text paste करें..."></textarea>
<button class="btn" onclick="convert()">Convert</button>

<div id="output"></div>

<script>
function findRegex(text, regex) {
    const m = text.match(regex);
    return m ? m[1] || m[0] : "NA";
}

function detectRelation(text) {
    if (/Father|वडिलांचे|पिता/.test(text)) return ["Father", text];
    if (/Husband|पतीचे|पति/.test(text)) return ["Husband", text];
    if (/Mother|आई|माता/.test(text)) return ["Mother", text];
    return ["NA", "NA"];
}

function detectGender(text) {
    if (/Female|स्त्री|महिला/.test(text)) return "Female";
    if (/Male|पुरुष/.test(text)) return "Male";
    return "NA";
}

function cleanName(str) {
    return str.replace(/Photo|Available|House|घर क्रमांक|Age|वय|:/gi, "")
              .replace(/\s+/g, " ").trim();
}

function convert() {
    const raw = document.getElementById("inputText").value.trim();
    if (!raw) return alert("कृपया text पेस्ट करें");

    const lines = raw.split("\n").map(e => e.trim()).filter(e => e);

    let csv = "SerialNo,EPIC_NO,PartNo,VoterName,RelationName,RelationType,HouseNo,Age,Gender\n";

    let html = "<table><tr>";
    ["SerialNo","EPIC_NO","PartNo","VoterName","RelationName","RelationType","HouseNo","Age","Gender"]
    .forEach(h => html += `<th>${h}</th>`);
    html += "</tr>";

    let serial = 1;

    lines.forEach(line => {

        const EPIC = findRegex(line, /([A-Z]{3}\d{7})/);
        const PART = findRegex(line, /(\d{1,3}\/\d{1,3}\/\d{1,4})/);

        const cleanedName = cleanName(line);

        const age = findRegex(line, /(?:Age|वय)\s*[:\-]?\s*(\d{1,2})/);
        const gender = detectGender(line);

        const [relationType, relationName] = detectRelation(line);

        const row = [
            serial,
            EPIC,
            PART,
            `"${cleanedName}"`,
            `"${relationName}"`,
            relationType,
            "NA",
            age,
            gender
        ];

        csv += row.join(",") + "\n";

        html += "<tr>";
        row.forEach(col => html += `<td>${col}</td>`);
        html += "</tr>";

        serial++;
    });

    html += "</table>";
    document.getElementById("output").innerHTML = html;
}
</script>

</body>
</html>
