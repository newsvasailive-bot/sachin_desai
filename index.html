<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text to CSV Converter</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f9f9f9; }
h2 { text-align:center; }
textarea { width:100%; height:200px; padding:10px; margin:10px 0; font-size:14px; }
button { padding:10px 20px; margin:5px; font-size:14px; cursor:pointer; }
#output { width:100%; height:200px; padding:10px; margin:10px 0; font-size:14px; white-space: pre; background:#eef; overflow:auto; }
</style>
</head>
<body>

<h2>Text to CSV Converter</h2>

<label>Paste your text here:</label>
<textarea id="inputText"></textarea>

<button onclick="convertCSV()">Convert</button>
<button onclick="copyOutput()">Copy Output</button>
<button onclick="downloadCSV()">Download CSV</button>

<label>CSV Output:</label>
<textarea id="output" readonly></textarea>

<script>
function convertCSV() {
    let raw = document.getElementById('inputText').value.trim();
    if (!raw) { alert('Please paste text first!'); return; }

    // Split by new lines
    let lines = raw.split(/\r?\n/).filter(l => l.trim() !== '');
    
    // Add fixed header
    let header = 'SerialNo,EPIC_NO,PartNo,VoterName,RelationName,RelationType,HouseNo,Age,Gender';
    let csv = [header];

    lines.forEach((line, index) => {
        // Remove extra quotes, trim spaces
        let cleaned = line.replace(/"/g,'').trim();
        if(cleaned){
            // Wrap text fields with quotes if contains comma
            let parts = cleaned.split(',');
            parts = parts.map(p => p.includes(',') ? `"${p.trim()}"` : p.trim());
            csv.push(parts.join(','));
        }
    });

    document.getElementById('output').value = csv.join('\n');
}

function copyOutput() {
    let output = document.getElementById('output');
    output.select();
    output.setSelectionRange(0, 99999);
    document.execCommand('copy');
    alert('CSV copied to clipboard!');
}

function downloadCSV() {
    let output = document.getElementById('output').value;
    if(!output){ alert('No CSV to download!'); return; }
    let blob = new Blob([output], { type: 'text/csv;charset=utf-8;' });
    let link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'output.csv';
    link.click();
}
</script>

</body>
</html>
