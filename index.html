<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Voter List Parser & CSV Generator</title>
<style>
body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
h2 { text-align:center; }
textarea { width:100%; height:200px; font-family: monospace; font-size:14px; padding:10px; margin-bottom:10px; }
button { padding:10px 15px; margin:5px 0; cursor:pointer; }
.table-container { width:100%; overflow-x:auto; margin-top:20px; }
table { border-collapse: collapse; width:100%; background:white; }
th, td { border:1px solid #333; padding:8px; text-align:left; font-size:14px; }
th { background:#222; color:white; position:sticky; top:0; }
tr:nth-child(even) { background:#f2f2f2; }
#outputCSV { height:150px; margin-top:10px; }
</style>
</head>
<body>

<h2>Voter List Parser & CSV Generator ðŸš€</h2>

<textarea id="rawInput" placeholder="à¤¯à¤¹à¤¾à¤ messy voter list paste à¤•à¤°à¥‡à¤‚"></textarea>
<button onclick="generateTableCSV()">Generate Table & CSV</button>
<button onclick="copyCSV()">Copy CSV ðŸ“‹</button>

<div class="table-container">
<table id="voterTable"></table>
</div>

<textarea id="outputCSV" readonly placeholder="CSV output à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡à¤—à¤¾ à¤¯à¤¹à¤¾à¤..."></textarea>

<script>
function generateTableCSV(){
    let text = document.getElementById("rawInput").value;
    if(!text.trim()){ alert("à¤•à¥ƒà¤ªà¤¯à¤¾ data paste à¤•à¤°à¥‡à¤‚"); return; }

    let lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l!=="");
    let table = document.getElementById("voterTable");
    table.innerHTML = "";

    let header = ["SerialNo","EPIC_NO","PartNo","VoterName","RelationName","RelationType","HouseNo","Age","Gender"];
    
    // Table Header
    let tr = document.createElement("tr");
    header.forEach(h=>{
        let th = document.createElement("th");
        th.textContent = h;
        tr.appendChild(th);
    });
    table.appendChild(tr);

    let current = {};
    let serial = 0;
    let csvOutput = [];
    csvOutput.push(header.join(","));

    lines.forEach((line, index)=>{
        let serialMatch = line.match(/^(\d+)\s/);
        let epicMatch = line.match(/RBG\d+|MRL\d+/);
        let partMatch = line.match(/\d+\/\d+\/\d+/);
        let ageMatch = line.match(/à¤µà¤¯\s*:\s*(\d+)/);
        let genderMatch = line.match(/à¤²à¤¿à¤‚à¤—\s*:\s*(.*)/);

        if(serialMatch && epicMatch && partMatch){
            if(Object.keys(current).length>0){ appendRow(current); current={}; }

            serial++;
            current.SerialNo = serial;
            current.EPIC_NO = epicMatch[0];
            current.PartNo = partMatch[0];

            let prevLine = lines[index-1]||"";
            current.VoterName = prevLine.replace(/^.*:|à¤®à¤¤à¤¦à¤¾à¤°à¤¾à¤šà¥‡ à¤ªà¥‚à¤°à¥à¤£|nà¤¾à¤‚à¤µ/gi,'').trim() || "NA";
            current.RelationName = "NA";
            current.RelationType = "NA";
            current.HouseNo = "NA";
            current.Age = "NA";
            current.Gender = "NA";
        } else {
            if(/à¤µà¤¡à¤¿à¤²à¤¾à¤‚à¤šà¥‡ à¤¨à¤¾à¤µ|à¤ªà¤¤à¥€à¤šà¥‡ à¤¨à¤¾à¤µ|à¤†à¤ˆà¤šà¥‡ à¤¨à¤¾à¤µ/.test(line)){
                current.RelationName = line.replace(/.*:|Available/gi,'').trim();
                current.RelationType = /à¤ªà¤¤à¥€/.test(line) ? "Husband" : /à¤†à¤ˆ/.test(line) ? "Mother" : "Father";
            }
            if(/à¤˜à¤° à¤•à¥à¤°à¤®à¤¾à¤‚à¤•/.test(line)){ current.HouseNo = line.replace(/.*:/,'').trim() || "NA"; }
            if(ageMatch){ current.Age = ageMatch[1]; }
            if(genderMatch){ current.Gender = genderMatch[1]; }
        }
    });

    appendRow(current);

    function appendRow(obj){
        if(!obj || !obj.EPIC_NO) return;
        let tr = document.createElement("tr");
        header.forEach(h=>{
            let td = document.createElement("td");
            td.textContent = obj[h] || "NA";
            tr.appendChild(td);
        });
        table.appendChild(tr);

        let csvLine = header.map(h=> `"${(obj[h]||"NA").replace(/"/g,'""')}"`).join(",");
        csvOutput.push(csvLine);
    }

    document.getElementById("outputCSV").value = csvOutput.join("\n");
}

function copyCSV(){
    let csvText = document.getElementById("outputCSV").value;
    if(!csvText.trim()){ alert("CSV generate à¤•à¤°à¥‡à¤‚ à¤ªà¤¹à¤²à¥‡"); return; }
    navigator.clipboard.writeText(csvText).then(()=> alert("CSV clipboard à¤®à¥‡à¤‚ copy à¤¹à¥‹ à¤—à¤¯à¤¾!"));
}
</script>

</body>
</html>
